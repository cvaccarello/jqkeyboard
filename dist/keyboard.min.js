"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}$.fn.caret=function(e,t){var a=this,i=a[0],s="selectionStart"in i;return/(email|number)/i.test(i.type)||s&&(i.selectionStart=e,i.selectionEnd=t||e),setTimeout(function(){a.focus()},1),this};var VirtualKeyboard,Keyboard=function(){function Keyboard(e){_classCallCheck(this,Keyboard),this.configuration=$.extend({},{title:"Virtual Keyboard",disabled:!1,draggable:!0,fixed_position:{left:void 0,top:void 0},key_delay:100,key_map:{placeholder:{name:"&nbsp;"},shift:{name:"Shift"},meta1:{name:"&123"},meta2:{name:"#+="},normal:{name:"ABC"},tab:{name:"Tab",onKeyPressed:this.keyPressedTab},accept:{name:"Accept",onKeyPressed:this.keyPressedAccept},ok:{name:"ok",onKeyPressed:this.keyPressedAccept},enter:{name:"Enter",onKeyPressed:this.keyPressedEnter},bksp:{name:"&#8678;",onKeyPressed:this.keyPressedDelete},space:{name:"&nbsp;",onKeyPressed:this.keyPressedSpace},done:{name:"Done",onKeyPressed:this.keyPressedDone},clear:{name:"Clear",onKeyPressed:this.keyPressedClear}},layout:{default:{normal:["q w e r t y u i o p {bksp}","{tab} a s d f g h j k l {placeholder}","{shift} z x c v b n m , . {shift}","{meta1} {space} {done}"],shift:["Q W E R T Y U I O P {bksp}","{tab} A S D F G H J K L {placeholder}","{shift} Z X C V B N M ! ? {shift}","{meta1} {space} {done}"],meta1:["1 2 3 4 5 6 7 8 9 0 {bksp}","{tab} - / : ; ( ) $ & @ {placeholder}","{meta2} . , ? ! ' \" {meta2}","{normal} {space} {done}"],meta2:["[ ] { } # % ^ * + = {bksp}","{tab} _ \\ | ~ < > &euro; &pound; &yen; {placeholder}","{meta1} . , ? ! ' \" {meta1}","{normal} {space} {done}"]},textarea:{normal:["q w e r t y u i o p {bksp}","{tab} a s d f g h j k l {enter}","{shift} z x c v b n m , . {shift}","{meta1} {space} {done}"],shift:["Q W E R T Y U I O P {bksp}","{tab} A S D F G H J K L {enter}","{shift} Z X C V B N M ! ? {shift}","{meta1} {space} {done}"],meta1:["1 2 3 4 5 6 7 8 9 0 {bksp}","{tab} - / : ; ( ) $ & @ {enter}","{meta2} . , ? ! ' \" {meta2}","{normal} {space} {done}"],meta2:["[ ] { } # % ^ * + = {bksp}","{tab} _ \\ | ~ < > &euro; &pound; &yen; {enter}","{meta1} . , ? ! ' \" {meta1}","{normal} {space} {done}"]},email:{normal:["q w e r t y u i o p {bksp}","{tab} a s d f g h j k l {placeholder}","{shift} z x c v b n m @ . {shift}","{meta1} _ - {space} .com {done}"],shift:["Q W E R T Y U I O P {bksp}","{tab} A S D F G H J K L {placeholder}","{shift} Z X C V B N M @ . {shift}","{meta1} _ - {space} .com {done}"],meta1:["1 2 3 4 5 6 7 8 9 0 {bksp}","{tab} | { } % ^ * / \\ ' {placeholder}","` $ & ~ # = + @ .","{normal} ! ? {space} .com {done}"]},number:{normal:["7 8 9 {bksp}","4 5 6 {tab}","1 2 3","0 . {accept}"]},tel:{normal:["7 8 9 {bksp}","4 5 6 {tab}","1 2 3","0 - {accept}"]}},classes:{keyboard_class:"virtual-keyboard",key_class:"virtual-key"},selectors:{keyboard_class:".virtual-keyboard",key_class:".virtual-key"}},e),this.ignore_types='[type="checkbox"], [type="radio"], [type="submit"], [type="reset"], [type="button"], [type="color"], [type="range"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], .no-keyboard, .disabled, .is-disabled, [disabled]',this.$body=$("body"),this.$html=$("html"),this.$hidden=$("<span>"),this.$keyboards=this._createKeyboards(),this.$keyboard=null,this.$input=null,this.original_input_text=null,this.current_keyboard_layout="",this.current_keyboard_type="",this.repeaterTimeout=null,this.repeaterInterval=null,this.disable_key_repeat=!1,this.moving=!1,this.mouse_position={x:0,y:0},this.keyboard_transform_position={x:0,y:0},this.keyboard_start_transform_position={x:0,y:0},this.keyboard_dimensions={width:0,height:0},this.screen_width=this.$html.outerWidth(),this.screen_height=window.innerHeight,this.body_position=this.$body.css("position"),this.body_margin={left:0,top:0},"static"!==this.body_position&&(this.body_margin.left+=parseInt(this.$body.css("margin-left")),this.body_margin.top+=parseInt(this.$body.css("margin-top"))),this.last_key_down={time:Date.now(),value:""}}return _createClass(Keyboard,[{key:"activate",value:function activate(){var r=this;$(document).on("click touchend","input, textarea",function(e){var t=$(e.currentTarget);t.is(r.ignore_types)||t.is(r.$input)||(r.isOpened&&r.closeKeyboard(),r.configuration.disabled||r.openKeyboard(t))}),$(document).on("mousedown touchstart",function(e){var t=r.configuration.selectors.keyboard_class,a=$(e.target);a.is(r.$input)||a.is(".etf-blocker")||r.isOpened&&!a.closest(t).length&&r.closeKeyboard()}),$(document).on("mousedown touchstart",".virtual-keyboard-title",function(e){r.moving=!0,r.mouse_position=r._getMousePosition(e),r.configuration.draggable&&(r.keyboard_start_transform_position=r.keyboard_transform_position),r.$body.addClass("is-dragging-virtual-keyboard"),r.$keyboard.addClass("is-dragging")}),$(document).on("mousemove touchmove",function(e){if(r.moving){e.preventDefault();var t=r._getMousePosition(e),a=t.x,i=t.y,s=(a=r.keyboard_start_transform_position.x+(a-r.mouse_position.x),i=r.keyboard_start_transform_position.y+(i-r.mouse_position.y),parseInt(r.$keyboard.css("left"))),o=parseInt(r.$keyboard.css("top")),n=r._containWithinScreen({x:s+a,y:o+i,width:r.keyboard_dimensions.width,height:r.keyboard_dimensions.height});a+=n.x,i+=n.y,r.keyboard_transform_position={x:a,y:i},r.$keyboard.css({transform:"translate("+a+"px, "+i+"px)"})}}),$(document).on("mouseup touchend",function(e){r.removeKeyRepeater(),r.moving&&(r.moving=!1,r.$body.removeClass("is-dragging-virtual-keyboard"),r.$keyboard.removeClass("is-dragging")),r.isOpened&&r.$input&&r.$input.focus()})}},{key:"reconfigure",value:function reconfigure(e){this.configuration=$.extend(!0,{},this.configuration,e),this.closeKeyboard(),this.$keyboards=this._createKeyboards()}},{key:"openKeyboard",value:function openKeyboard(e){this.$input=e.addClass("is-focus-virtual-input").focus(),this.original_input_text=this.$input.val(),this.current_keyboard_type=this._getType(this.$input),this.current_keyboard_layout=Object.keys(this.configuration.layout[this.current_keyboard_type])[0],this.$keyboard=this.$keyboards.filter('[data-keyboard-type="'+this.current_keyboard_type+'"]'),this.$keyboard.children().hide().filter('[data-layout-type="'+this.current_keyboard_layout+'"]').show(),this.isFixed?(this.$keyboard.appendTo(this.$body).css({position:"fixed",top:this.configuration.fixed_position.top+"px",left:this.configuration.fixed_position.left+"px"}),this.keyboard_dimensions={width:this.$keyboard.outerWidth(),height:this.$keyboard.outerHeight()}):this._appendPositionedKeyboard(),this.configuration.draggable&&(this.isFixed?this.$keyboard.css({transform:"translate("+this.keyboard_transform_position.x+"px, "+this.keyboard_transform_position.y+"px)"}):this.$keyboard.css({transform:"translate(0)"}))}},{key:"touchendDelayedCloseKeyboard",value:function touchendDelayedCloseKeyboard(){var e=this;$(document).on("touchend",function finalize(){e.closeKeyboard(),$(document).off("touchend",finalize)})}},{key:"closeKeyboard",value:function closeKeyboard(){this.$keyboard&&this.$keyboard.detach(),this.$input&&this.$input.removeClass("is-focus-virtual-input"),this.resetKeyboard()}},{key:"resetKeyboard",value:function resetKeyboard(){this.$input=null,this.original_input_text=null,this.keyboard_dimensions={width:0,height:0},this.configuration.draggable&&!this.isFixed&&(this.keyboard_transform_position={x:0,y:0},this.keyboard_start_transform_position={x:0,y:0})}},{key:"switchLayout",value:function switchLayout(e){var t=$(e.currentTarget),a=this.configuration.selectors.key_class,i=(t.attr("data-value"),t.attr("data-layout-type"));i==this.current_keyboard_layout&&(i=Object.keys(this.configuration.layout[this.current_keyboard_type])[0]),this.$keyboard.children('[data-layout-type="'+this.current_keyboard_layout+'"]').hide().find(".is-selected").removeClass("is-selected"),this.$keyboard.children('[data-layout-type="'+i+'"]').show().find(a+'[data-layout-type="'+i+'"]').addClass("is-selected"),this.current_keyboard_layout=i}},{key:"setKeyPressedClass",value:function setKeyPressedClass(e){var t=$(e.currentTarget);t.addClass("was-clicked"),setTimeout(function(){t.removeClass("was-clicked")},50)}},{key:"setKeyRepeater",value:function setKeyRepeater(e){var t=this;this.disable_key_repeat=!1,e.call(this),this.removeKeyRepeater(),this.disable_key_repeat||(this.repeaterTimeout=setTimeout(function(){t.repeaterInterval=setInterval(function(){e.call(t)},100)},800))}},{key:"removeKeyRepeater",value:function removeKeyRepeater(){clearTimeout(this.repeaterTimeout),clearInterval(this.repeaterInterval)}},{key:"keyPressed",value:function keyPressed(e){if(this.$input){var t=$(e.currentTarget).attr("data-value"),a=this._getCursorPositionAndText(),i=a.start.val+t+a.end.val,s=this.$input.attr("maxlength");s&&s<i.length||(this.$input.val(i),this.$input.caret(a.start.pos+t.length))}}},{key:"keyPressedDelete",value:function keyPressedDelete(){var e=this._getCursorPositionAndText(),t="";t=e.start.pos===e.end.pos?(e.start.pos-=1,e.start.val.substr(0,e.start.pos)+e.end.val):e.start.val+e.end.val,this.$input.val(t),this.$input.caret(e.start.pos)}},{key:"keyPressedSpace",value:function keyPressedSpace(){var e=this._getCursorPositionAndText(),t=e.start.val+" "+e.end.val,a=this.$input.attr("maxlength");a&&a<t.length||(this.$input.val(t),this.$input.caret(e.start.pos+1))}},{key:"keyPressedCancel",value:function keyPressedCancel(){this.disable_key_repeat=!0,this.$input.val(this.original_input_text),this.touchendDelayedCloseKeyboard()}},{key:"keyPressedDone",value:function keyPressedDone(){this.disable_key_repeat=!0,this.touchendDelayedCloseKeyboard()}},{key:"keyPressedClear",value:function keyPressedClear(){this.disable_key_repeat=!0,this.$input.val("")}},{key:"keyPressedAccept",value:function keyPressedAccept(){this.disable_key_repeat=!0,this.touchendDelayedCloseKeyboard()}},{key:"keyPressedEnter",value:function keyPressedEnter(){var e=this._getCursorPositionAndText(),t=e.start.val+"\n"+e.end.val,a=this.$input.attr("maxlength");a&&a<t.length||(this.$input.val(t),this.$input.caret(e.start.pos+1))}},{key:"keyPressedTab",value:function keyPressedTab(){var e=$("input, textarea");this.disable_key_repeat=!0;var t=$(e.get(e.index(this.$input)+1));t&&t.length&&(this.closeKeyboard(),setTimeout(function(){t.focus()},1),t.is(this.ignore_types)||this.configuration.disabled||this.openKeyboard(t));$(document).on("touchstart",function finalize(){$(".etf-blocker").hide(),$(document).off("touchstart",finalize)})}},{key:"_getType",value:function _getType(){var e=this.$input.attr("data-keyboard-type")||this.$input.attr("type")||this.$input.prop("tagName").toLowerCase();return!this.configuration.layout[e]||e in this.configuration.layout[e]?"default":e}},{key:"_createKeyboards",value:function _createKeyboards(){var a=this,e=this.configuration.classes.keyboard_class,t=this.configuration.classes.key_class,i=$();for(var s in this.configuration.layout){var o=this.configuration.layout[s],n=$("<div>");for(var r in n.attr("data-keyboard-type",s).addClass(e),this.configuration.draggable&&n.addClass("is-draggable"),o){var d=o[r],l=$("<div>");for(var u in l.attr("data-layout-type",r),this.configuration.draggable&&l.append('<div class="virtual-keyboard-title">'+this.configuration.title+"</div>"),d){var y=d[u],h=$("<div>"),c=!0,p=!1,b=void 0;try{for(var f,k=y.split(" ")[Symbol.iterator]();!(c=(f=k.next()).done);c=!0){var _=f.value,m=$("<button>"),g=_;if("{"===_[0]&&1<_.length){var v=_=_.substr(1,_.length-2),x=!1;_ in this.configuration.key_map&&(this.configuration.key_map[_].name&&(g=this.configuration.key_map[_].name),this.configuration.key_map[_].onKeyPressed&&(x=!0,m.data("customFunction",this.configuration.key_map[_].onKeyPressed))),x?m.attr("data-layout-type",v).on("mousedown touchstart",function(e){var t=$(e.currentTarget).attr("data-value");a.last_key_down.value==t&&Date.now()-a.last_key_down.time<a.configuration.key_delay||(a.last_key_down={time:Date.now(),value:t},a.setKeyRepeater(function(){$(e.currentTarget).data("customFunction").call(a,e),a.setKeyPressedClass(e)}))}):m.attr("data-layout-type",v).on("mousedown touchstart",function(e){var t=$(e.currentTarget).attr("data-value");e.preventDefault(),a.last_key_down.value==t&&Date.now()-a.last_key_down.time<a.configuration.key_delay||(a.last_key_down={time:Date.now(),value:t},a.setKeyRepeater(function(){a.switchLayout(e),a.setKeyPressedClass(e)}))})}else m.on("mousedown touchstart",function(e){var t=$(e.currentTarget).attr("data-value");e.preventDefault(),a.last_key_down.value==t&&Date.now()-a.last_key_down.time<a.configuration.key_delay||(a.last_key_down={time:Date.now(),value:t},a.setKeyRepeater(function(){a.keyPressed(e),a.setKeyPressedClass(e)}))});m.addClass(t).html(g).attr("data-value",this.$hidden.html(_).text()).appendTo(h)}}catch(e){p=!0,b=e}finally{try{c||null==k.return||k.return()}finally{if(p)throw b}}h.appendTo(l)}l.appendTo(n)}i=i.add(n)}return i}},{key:"_appendPositionedKeyboard",value:function _appendPositionedKeyboard(){var e=this.$input.offset(),t=(this.$input.outerWidth(),this.$input.outerHeight());this.$keyboard.css("visibility","hidden").appendTo(this.$body),this.keyboard_dimensions={width:this.$keyboard.outerWidth(),height:this.$keyboard.outerHeight()};this.$body.scrollTop();var a=this._containWithinScreen({x:e.left,y:e.top+t,width:this.keyboard_dimensions.width,height:this.keyboard_dimensions.height});if(e.left+=a.x,a.y<0){var i=this.$input.parent().closest("label");if(i.length||(i=$('label[for="'+this.$input.attr("id")+'"]')),i.length){var s=i.offset();e.top-=e.top-s.top}e.top-=t+this.keyboard_dimensions.height}this.$keyboard.css({visibility:"visible",top:e.top+t-this.body_margin.top+"px",left:e.left-this.body_margin.left+"px"})}},{key:"_getCursorPositionAndText",value:function _getCursorPositionAndText(){var t="";this.$input&&(t=this.$input.val());try{var a=this.$input[0].selectionStart,i=this.$input[0].selectionEnd}catch(e){a=t.length,i=t.length}return{start:{pos:a,val:t.substr(0,a)},end:{pos:i,val:t.substr(i,t.length)}}}},{key:"_getMousePosition",value:function _getMousePosition(e){var t=e.pageX,a=e.pageY;return(isNaN(t)||isNaN(a))&&(t=e.touches[0].pageX,a=e.touches[0].pageY),{x:t,y:a}}},{key:"_containWithinScreen",value:function _containWithinScreen(e){var t=this.$body.scrollTop(),a=0,i=0;return e.width=e.width?e.width:0,e.height=e.height?e.height:0,e.x+=this.body_margin.left,e.y+=this.body_margin.top,e.x<0?a=-e.x:e.x+e.width>this.screen_width&&(a=this.screen_width-(e.x+e.width)),e.y<0+t?i=t-e.y:e.y+e.height>this.screen_height+t&&(i=this.screen_height+t-(e.y+e.height)),{x:a,y:i}}},{key:"isOpened",get:function get(){return!!this.$keyboard&&!!this.$keyboard.parent().length}},{key:"isFixed",get:function get(){return!isNaN(this.configuration.fixed_position.left)&&!isNaN(this.configuration.fixed_position.top)}}]),Keyboard}();(VirtualKeyboard=new Keyboard).activate();
//# sourceMappingURL=keyboard.min.js.map
